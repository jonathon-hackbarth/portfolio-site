---
import { formatDateRange } from '../utils/dateFormatter';

const resumeModule = import.meta.glob('../../public/resume.json', { eager: true });
const resumeFile = Object.values(resumeModule)[0] as any;
const resumeData = resumeFile.default || resumeFile;
const { basics, work, skills } = resumeData;
---

<section id="resume" aria-labelledby="resume-heading">
  <div class="max-w-[var(--container-max)] mx-auto">
    <div class="flex justify-between items-center" style="align-items: center; margin-bottom: var(--spacing-xl);">
      <h2 id="resume-heading" class="font-bold text-[var(--text-primary)] tracking-tight" style="font-size: var(--font-size-h2); margin: 0; line-height: 1.1;">Resume</h2>
      <a
        href="/resume.pdf"
        download="Jonathon-Hackbarth-Resume.pdf"
        class="inline-flex items-center gap-2 bg-[var(--accent)] hover:bg-[var(--accent-hover)] text-white font-semibold text-sm transition-all rounded-xl shadow-md hover:shadow-lg hover:translate-y-[-2px]"
        style="padding: 10px 20px;"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
        </svg>
        Download PDF
      </a>
    </div>

    <div class="card">
      {basics && (
        <div class="pb-8 border-b border-[var(--border-card)] mb-16 flex flex-col gap-4">
          <h1 class="text-3xl sm:text-4xl font-bold text-[var(--text-primary)] tracking-tight">{basics.name}</h1>
          <p class="text-xl text-[var(--accent)] font-semibold">{basics.label}</p>
          
          <div class="flex flex-wrap gap-3 text-sm">
            <a href={`mailto:${basics.email}`} class="text-[var(--accent)] hover:text-[var(--accent-hover)] font-medium transition-colors">
              {basics.email}
            </a>
            <span class="text-[var(--text-secondary)]">•</span>
            <span class="text-[var(--text-secondary)] font-medium">{basics.location?.countryCode || 'US'}</span>
            <span class="text-[var(--text-secondary)]">•</span>
            <a href={basics.url} target="_blank" rel="noopener noreferrer" class="text-[var(--accent)] hover:text-[var(--accent-hover)] font-medium transition-colors">
              {basics.url?.replace('https://', '')}
            </a>
            {basics.profiles && basics.profiles.map((profile: any) => (
              <>
                <span class="text-[var(--text-secondary)]">•</span>
                <a href={profile.url} target="_blank" rel="noopener noreferrer" class="text-[var(--accent)] hover:text-[var(--accent-hover)] font-medium transition-colors">
                  {profile.network}
                </a>
              </>
            ))}
          </div>

          <p class="text-base leading-relaxed text-[var(--text-primary)]">{basics.summary}</p>
          <br>
        </div>
      )}

      {work && work.length > 0 && (
        <div class="pt-16 pb-8 border-b border-[var(--border-card)]">
          <h2 class="text-2xl font-bold mb-8 text-[var(--text-primary)] tracking-tight">Experience</h2>
          <div class="space-y-6">
            {work.map((job: any) => (
              <div class="experience-card">
                <h3 class="job-title">{job.position}</h3>
                <span class="company-badge">{job.name}</span>
                <p class="date-range">{formatDateRange(job.startDate, job.endDate)}</p>
                {job.summary && <p class="text-sm mb-6 text-[var(--text-secondary)]">{job.summary}</p>}
                {job.highlights && job.highlights.length > 0 && (
                  <ul>
                    {job.highlights.map((highlight: any) => (
                      <li>{highlight}</li>
                    ))}
                  </ul>
                )}
              </div>
            ))}
          </div>
        </div>
      )}

      {skills && skills.length > 0 && (
        <div class="pt-8 pb-8">
          <h2 class="text-2xl font-bold mb-8 text-[var(--text-primary)] tracking-tight">Skills</h2>
          <div class="skills-grid">
            {skills.map((skillGroup: any) => (
              <div class="skill-card">
                <h3 class="skill-title">{skillGroup.name}</h3>
                <p class="skill-items">{skillGroup.keywords.join(', ')}</p>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  </div>
</section>
