---
import type { ProjectData } from "../utils/projectUtils";

export interface Props {
  project: ProjectData;
  index: number;
}

const { project: p, index = 0 } = Astro.props;

// Map project names to their image files (light and dark versions)
const imageMap: Record<string, { light: string; dark: string }> = {
  "portfolio-site": {
    light: "/portfolio-light.png",
    dark: "/portfolio-dark.png",
  },
  "conversion-app": {
    light: "/conversion-app-light.png",
    dark: "/conversion-app-dark.png",
  },
};

const imageSet = imageMap[p.name] || null;
const hasImage = imageSet !== null;
const isEvenIndex = index % 2 === 0;
---

<article class="project-row" aria-labelledby={`project-title-${p.name}`}>
  <div class="project-card">
    <h3 id={`project-title-${p.name}`} class="project-title">
      {p.name}
    </h3>
    <p class="project-description">
      {p.description || "No description available."}
    </p>
    <div class="project-buttons" role="group" aria-label="Project actions">
      {
        p.homepage ? (
          <a
            href={p.homepage}
            target="_blank"
            rel="noopener noreferrer"
            class="project-button-tiertiary"
            aria-label={`Visit ${p.name} website`}
          >
            Site
          </a>
        ) : null
      }
      <button
        type="button"
        class="project-button-primary clone-btn"
        data-clone-url={p.html_url}
        aria-label={`Copy git clone command for ${p.name}`}
        data-clone-label="Clone"
        data-clone-copied="Copied!"
        data-clone-failed="Failed"
      >
        Clone
      </button>
      <a
        href={p.html_url}
        target="_blank"
        rel="noopener noreferrer"
        class="project-button-secondary"
        aria-label={`View ${p.name} repository on GitHub`}
      >
        Repo
      </a>
    </div>
    <hr class="project-divider" aria-hidden="true" />
    {
      p.languages && p.languages.length > 0 && (
        <div
          class="project-languages"
          role="list"
          aria-label="Project languages"
        >
          {p.languages.map((lang) => (
            <div class="language-tag" role="listitem">
              <span class="language-name">{lang.name}</span>
              <span
                class="language-percentage"
                aria-label={`${lang.percentage}% ${lang.name}`}
              >
                {lang.percentage}%
              </span>
            </div>
          ))}
        </div>
      )
    }
    <footer class="project-footer">
      <div class="flex items-center">
        <a
          href={p.html_url}
          target="_blank"
          rel="noopener noreferrer"
          aria-label={`View ${p.name} on GitHub`}
          class="github-link"
        >
          GitHub
        </a>
        {
          p.fork ? (
            <span class="ml-2 text-xs text-gray-500" title="Forked repository">
              Fork
            </span>
          ) : null
        }
      </div>
      <time class="update-time" datetime={p.pushed_at}>
        Updated on{" "}
        {
          new Date(p.pushed_at).toLocaleDateString("en-US", {
            day: "numeric",
            month: "long",
            year: "numeric",
            timeZone: "UTC",
          })
        }
        {" "}UTC
      </time>
    </footer>
  </div>
</article>
